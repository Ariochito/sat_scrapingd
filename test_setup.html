<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Test - Sistema CFDI</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="p-4">
<div class="container">
    <h2 class="mb-4 text-primary">Test - Sistema CFDI</h2>
    
    <div class="alert alert-info">
        <h5>Pruebas del Sistema:</h5>
        <ol>
            <li><strong>Core.js</strong>: <span id="test-core">❌ No cargado</span></li>
            <li><strong>API.js</strong>: <span id="test-api">❌ No cargado</span></li>
            <li><strong>UI.js</strong>: <span id="test-ui">❌ No cargado</span></li>
            <li><strong>Botones</strong>: <span id="test-buttons">❌ No probado</span></li>
        </ol>
    </div>
    
    <div class="mb-3">
        <input type="text" class="form-control mb-2" id="rfc" placeholder="RFC" value="XAXX010101000">
        <input type="password" class="form-control mb-2" id="ciec" placeholder="CIEC" value="12345678">
        <input type="date" class="form-control mb-2" id="fechaInicio" value="2024-01-01">
        <input type="date" class="form-control mb-2" id="fechaFin" value="2024-01-31">
        <select class="form-select mb-2" id="tipo">
            <option value="emitidas">Emitidas</option>
            <option value="recibidas">Recibidas</option>
        </select>
        <select class="form-select mb-2" id="estado">
            <option value="">Todos</option>
            <option value="vigente">Vigente</option>
            <option value="cancelado">Cancelado</option>
        </select>
        <select class="form-select mb-2" id="complemento">
            <option value="">Todos</option>
            <option value="nomina">Nómina</option>
            <option value="pagos">Pagos</option>
        </select>
        <input type="text" class="form-control mb-2" id="rfcFiltro" placeholder="RFC Filtro">
        <input type="text" class="form-control mb-2" id="rfcTerceros" placeholder="RFC Terceros">
        <select class="form-select mb-2" id="mesPeriodo" style="display:none;">
            <option value="01">Enero</option>
            <option value="02">Febrero</option>
        </select>
        <input type="number" class="form-control mb-2" id="anioPeriodo" placeholder="Año" value="2024" style="display:none;">
    </div>
    
    <div class="mb-3">
        <button type="button" class="btn btn-success" id="loginSatBtn">Test Login SAT</button>
        <button type="button" class="btn btn-danger" id="logoutSatBtn">Test Logout SAT</button>
        <button type="button" class="btn btn-secondary" id="toggleDebugBtn">Test Toggle Debug</button>
        <button type="button" class="btn btn-primary" id="buscarBtn">Test Buscar</button>
        <button type="button" class="btn btn-info" id="descargarTodosBtn">Test Descargar Todos</button>
        <button type="button" class="btn btn-warning" id="buscarDescargarBtn">Test Buscar y Descargar</button>
    </div>
    
    <div id="statusLogin" class="mb-3"></div>
    <div id="debugPanel" class="d-none">
        <div id="debugContent"></div>
    </div>
    <div id="resultados"></div>
    
    <div class="spinner-border d-none" id="spinner"></div>
</div>

<!-- Toast Container -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
    <div id="toastContainer"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script type="module">
try {
    // Test 1: Core.js
    const { $, mostrarSpinner, debugLog, clearDebug, showToast } = await import('./js/core.js');
    document.getElementById('test-core').innerHTML = '✅ Cargado correctamente';
    
    // Test 2: API.js  
    const { loginSat, logoutSat, statusSat, searchCfdi, downloadCfdi, retryPendingCfdi } = await import('./js/cfdi-api.js');
    document.getElementById('test-api').innerHTML = '✅ Cargado correctamente';
    
    // Test 3: UI.js
    await import('./js/cfdi-ui.js');
    document.getElementById('test-ui').innerHTML = '✅ Cargado correctamente';
    
    // Test 4: Botones
    setTimeout(() => {
        const buttons = ['loginSatBtn', 'logoutSatBtn', 'toggleDebugBtn'];
        let allWork = true;
        
        buttons.forEach(btnId => {
            const btn = document.getElementById(btnId);
            if (!btn || !btn.onclick) {
                allWork = false;
                console.error(`Botón ${btnId} no funciona`);
            }
        });
        
        if (allWork) {
            document.getElementById('test-buttons').innerHTML = '✅ Todos los botones funcionan';
            showToast('¡Sistema funcionando correctamente!', 'success');
        } else {
            document.getElementById('test-buttons').innerHTML = '❌ Algunos botones no funcionan';
            showToast('Algunos botones no están funcionando', 'danger');
        }
    }, 1000);
    
} catch (error) {
    console.error('Error cargando módulos:', error);
    showToast('Error: ' + error.message, 'danger');
}
</script>

</body>
</html>